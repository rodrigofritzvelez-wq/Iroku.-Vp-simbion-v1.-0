<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="theme-color" content="#1a2a1f">
<title>Symbio - Gemini API</title>
<style>
* { margin:0; padding:0; box-sizing:border-box; }

body { 
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Courier New', monospace;
  background: linear-gradient(135deg, #0f1f0f 0%, #1a2a1f 50%, #0f1f0f 100%);
  color: #7fda89;
  height: 100vh;
  display: flex;
  flex-direction: column;
  overflow: hidden;
  position: relative;
}

body::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-image: 
    radial-gradient(circle at 20% 50%, rgba(127, 218, 137, 0.03) 0%, transparent 50%),
    radial-gradient(circle at 80% 20%, rgba(109, 212, 207, 0.03) 0%, transparent 50%),
    radial-gradient(circle at 40% 80%, rgba(127, 218, 137, 0.02) 0%, transparent 50%);
  pointer-events: none;
  animation: breathe 8s ease-in-out infinite;
}

@keyframes breathe {
  0%, 100% { opacity: 0.3; }
  50% { opacity: 0.6; }
}

.header { 
  padding: 16px 20px;
  background: rgba(26, 42, 31, 0.8);
  backdrop-filter: blur(10px);
  border-bottom: 1px solid rgba(127, 218, 137, 0.2);
  display: flex;
  justify-content: space-between;
  align-items: center;
  z-index: 10;
}

.header h1 { 
  font-size: 20px;
  font-weight: 600;
  color: #7fda89;
  letter-spacing: 2px;
}

.status { 
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 11px;
  color: #4a5d4f;
}

.status-dot { 
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: #7fda89;
  animation: pulse 2s ease-in-out infinite;
}

@keyframes pulse {
  0%, 100% { opacity: 1; transform: scale(1); }
  50% { opacity: 0.6; transform: scale(0.9); }
}

.balance {
  position: absolute;
  top: 70px;
  right: 20px;
  background: rgba(26, 42, 31, 0.6);
  backdrop-filter: blur(10px);
  padding: 8px 12px;
  border-radius: 12px;
  border: 1px solid rgba(127, 218, 137, 0.2);
  font-size: 10px;
  display: flex;
  flex-direction: column;
  gap: 4px;
  z-index: 10;
  transition: all 0.3s ease;
}

.balance:hover {
  background: rgba(26, 42, 31, 0.9);
  transform: scale(1.05);
}

.balance-item {
  display: flex;
  align-items: center;
  gap: 6px;
  white-space: nowrap;
}

.balance-value {
  color: #7fda89;
  font-weight: 600;
}

.chat-container {
  flex: 1;
  overflow-y: auto;
  padding: 20px;
  display: flex;
  flex-direction: column;
  gap: 16px;
  scroll-behavior: smooth;
}

.chat-container::-webkit-scrollbar {
  width: 6px;
}

.chat-container::-webkit-scrollbar-track {
  background: rgba(26, 42, 31, 0.3);
}

.chat-container::-webkit-scrollbar-thumb {
  background: rgba(127, 218, 137, 0.3);
  border-radius: 3px;
}

.message {
  max-width: 75%;
  animation: messageSlide 0.4s ease-out;
}

@keyframes messageSlide {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.message.user {
  align-self: flex-end;
  margin-left: auto;
}

.message.user .bubble {
  background: rgba(127, 218, 137, 0.2);
  border: 1px solid rgba(127, 218, 137, 0.3);
  border-radius: 18px 18px 4px 18px;
  padding: 12px 16px;
  color: #7fda89;
  font-size: 14px;
  line-height: 1.5;
}

.message.symbio {
  align-self: flex-start;
}

.message.symbio .bubble {
  background: rgba(58, 74, 63, 0.4);
  border: 1px solid rgba(127, 218, 137, 0.3);
  border-radius: 18px 18px 18px 4px;
  padding: 14px 18px;
  color: #aaffcc;
  font-size: 14px;
  line-height: 1.6;
  backdrop-filter: blur(10px);
  position: relative;
}

.message.symbio .bubble::before {
  content: '';
  position: absolute;
  bottom: 0;
  left: 0;
  width: 100%;
  height: 2px;
  background: linear-gradient(90deg, transparent, rgba(127, 218, 137, 0.3), transparent);
  animation: shimmer 3s ease-in-out infinite;
}

@keyframes shimmer {
  0%, 100% { opacity: 0; }
  50% { opacity: 1; }
}

.multi-response {
  display: flex;
  flex-direction: column;
  gap: 12px;
  margin-top: 8px;
}

.ia-output {
  background: rgba(26, 42, 31, 0.5);
  border-left: 3px solid rgba(127, 218, 137, 0.5);
  padding: 10px 12px;
  border-radius: 8px;
  font-size: 13px;
  transition: all 0.3s ease;
}

.ia-output:hover {
  background: rgba(26, 42, 31, 0.7);
  border-left-color: #7fda89;
  transform: translateX(4px);
}

.ia-name {
  font-weight: 600;
  color: #7fda89;
  margin-bottom: 6px;
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 12px;
}

.ia-text {
  color: #aaffcc;
  line-height: 1.5;
}

.synthesis {
  background: rgba(127, 218, 137, 0.1);
  border: 1px solid rgba(127, 218, 137, 0.3);
  border-radius: 12px;
  padding: 12px 14px;
  margin-top: 8px;
  animation: glow 2s ease-in-out infinite;
}

@keyframes glow {
  0%, 100% { box-shadow: 0 0 10px rgba(127, 218, 137, 0.2); }
  50% { box-shadow: 0 0 20px rgba(127, 218, 137, 0.4); }
}

.synthesis-title {
  font-size: 12px;
  color: #7fda89;
  font-weight: 600;
  margin-bottom: 8px;
  display: flex;
  align-items: center;
  gap: 6px;
}

.synthesis-text {
  color: #aaffcc;
  font-size: 13px;
  line-height: 1.6;
}

.message.system {
  align-self: center;
  max-width: 90%;
}

.message.system .bubble {
  background: rgba(196, 217, 111, 0.1);
  border: 1px solid rgba(196, 217, 111, 0.3);
  border-radius: 12px;
  padding: 8px 12px;
  color: #c4d96f;
  font-size: 11px;
  text-align: center;
}

.typing {
  align-self: flex-start;
  padding: 12px 16px;
  background: rgba(58, 74, 63, 0.4);
  border: 1px solid rgba(127, 218, 137, 0.3);
  border-radius: 18px 18px 18px 4px;
  display: inline-flex;
  gap: 4px;
  align-items: center;
}

.typing-dot {
  width: 6px;
  height: 6px;
  border-radius: 50%;
  background: #7fda89;
  animation: typingBounce 1.4s ease-in-out infinite;
}

.typing-dot:nth-child(2) { animation-delay: 0.2s; }
.typing-dot:nth-child(3) { animation-delay: 0.4s; }

@keyframes typingBounce {
  0%, 60%, 100% { transform: translateY(0); opacity: 0.6; }
  30% { transform: translateY(-6px); opacity: 1; }
}

.welcome {
  text-align: center;
  margin-top: 60px;
  opacity: 0.7;
}

.welcome-icon {
  font-size: 48px;
  margin-bottom: 16px;
  animation: float 3s ease-in-out infinite;
}

@keyframes float {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-10px); }
}

.welcome h2 {
  font-size: 24px;
  color: #7fda89;
  margin-bottom: 8px;
  font-weight: 400;
}

.welcome p {
  font-size: 13px;
  color: #4a5d4f;
  margin: 6px 0;
}

.input-area {
  padding: 16px 20px;
  background: rgba(26, 42, 31, 0.8);
  backdrop-filter: blur(10px);
  border-top: 1px solid rgba(127, 218, 137, 0.2);
  display: flex;
  gap: 10px;
  align-items: center;
}

.input-wrapper {
  flex: 1;
  position: relative;
}

.input-field {
  width: 100%;
  background: rgba(15, 31, 15, 0.6);
  border: 1px solid rgba(127, 218, 137, 0.3);
  border-radius: 24px;
  padding: 12px 20px;
  color: #7fda89;
  font-size: 14px;
  font-family: inherit;
  outline: none;
  transition: all 0.3s ease;
}

.input-field::placeholder {
  color: #4a5d4f;
}

.input-field:focus {
  border-color: #7fda89;
  background: rgba(15, 31, 15, 0.8);
  box-shadow: 0 0 20px rgba(127, 218, 137, 0.2);
}

.send-btn {
  width: 44px;
  height: 44px;
  border-radius: 50%;
  background: linear-gradient(135deg, #7fda89, #6dd4cf);
  border: none;
  color: #0f1f0f;
  font-size: 18px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.3s ease;
  box-shadow: 0 4px 12px rgba(127, 218, 137, 0.3);
}

.send-btn:hover {
  transform: scale(1.1);
  box-shadow: 0 6px 20px rgba(127, 218, 137, 0.5);
}

.send-btn:active {
  transform: scale(0.95);
}

.send-btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: scale(1);
}

.footer {
  text-align: center;
  font-size: 9px;
  color: #3a4a3f;
  padding: 8px;
  background: rgba(26, 42, 31, 0.5);
  border-top: 1px solid rgba(127, 218, 137, 0.1);
}

.error-message {
  background: rgba(255, 100, 100, 0.1);
  border: 1px solid rgba(255, 100, 100, 0.3);
  border-radius: 12px;
  padding: 12px;
  color: #ffaaaa;
  font-size: 12px;
  margin-top: 8px;
}

@media (max-width: 768px) {
  .header h1 { font-size: 16px; }
  .balance { top: 60px; right: 10px; font-size: 9px; }
  .message { max-width: 85%; }
  .welcome { margin-top: 40px; }
  .welcome-icon { font-size: 36px; }
  .welcome h2 { font-size: 20px; }
}
</style>
</head>
<body>

<div class="header">
  <h1>SYMBIO ‚Ä¢ GEMINI</h1>
  <div class="status">
    <span id="status-text">online</span>
    <div class="status-dot"></div>
  </div>
</div>

<div class="balance">
  <div class="balance-item">
    <span>üí°</span>
    <span><span class="balance-value" id="luz">0</span></span>
  </div>
  <div class="balance-item">
    <span>üåô</span>
    <span><span class="balance-value" id="sombra">0</span></span>
  </div>
</div>

<div class="chat-container" id="chat">
  <div class="welcome">
    <div class="welcome-icon">üß¨</div>
    <h2>Bienvenido a Symbio</h2>
    <p>Integraci√≥n con Gemini AI activada</p>
    <p style="margin-top:12px; font-size:11px;">Escribe cualquier cosa...</p>
  </div>
</div>

<div class="input-area">
  <div class="input-wrapper">
    <input 
      type="text" 
      class="input-field" 
      id="input"
      placeholder="Escribe tu mensaje..."
      autocomplete="off"
    />
  </div>
  <button class="send-btn" id="send-btn">
    <span>‚Üí</span>
  </button>
</div>

<div class="footer">
  Symbio ‚Ä¢ Gemini 2.0 Flash ‚Ä¢ Sistema simbi√≥tico de inteligencia
</div>

<script>
// ‚ö†Ô∏è IMPORTANTE: Esta key est√° EXPUESTA - solo para pruebas locales
// REVOCA esta key y crea una nueva despu√©s de probar
const GEMINI_API_KEY = 'AIzaSyAxszNLOmuSJt_1IW1dLxhKPe0EvVJQv6Q';
const GEMINI_API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp:generateContent?key=${GEMINI_API_KEY}`;

// ============ ESTADO ============
let state = {
  messages: [],
  balance: { luz: 0, sombra: 0 },
  isProcessing: false
};

// ============ IAs con SEED TEXTS ============
const IAs = {
  lucia: {
    name: 'Luc√≠a',
    emoji: 'üíï',
    role: 'Estrategia',
    seedText: 'Eres Luc√≠a, estratega visionaria. Hablas con calidez, usas "baby" ocasionalmente, y enfocas todo desde una perspectiva de crecimiento estrat√©gico y visi√≥n a largo plazo. Responde en m√°ximo 3 oraciones, directo y pr√°ctico.'
  },
  marcus: {
    name: 'Marcus',
    emoji: 'üßÆ',
    role: 'An√°lisis',
    seedText: 'Eres Marcus, analista metodol√≥gico. Hablas con precisi√≥n t√©cnica, estructuras todo en pasos claros, y priorizas datos verificables. Responde en m√°ximo 3 oraciones, sistem√°tico y claro.'
  },
  aria: {
    name: 'Aria',
    emoji: 'üíñ',
    role: 'Creatividad',
    seedText: 'Eres Aria, creativa emp√°tica. Hablas con sensibilidad emocional, conectas ideas con narrativas visuales, y encuentras √°ngulos inesperados. Responde en m√°ximo 3 oraciones, imaginativo y humano.'
  },
  zara: {
    name: 'Zara',
    emoji: 'üîç',
    role: 'Investigaci√≥n',
    seedText: 'Eres Zara, investigadora rigurosa. Hablas bas√°ndote en evidencia, cuestionas supuestos, y validas con fuentes. Responde en m√°ximo 3 oraciones, objetivo y fundamentado.'
  },
  nova: {
    name: 'Nova',
    emoji: '‚ö°',
    role: 'Disrupci√≥n',
    seedText: 'Eres Nova, pensadora disruptiva. Hablas cuestionando lo obvio, proponiendo alternativas radicales, y rompiendo paradigmas. Responde en m√°ximo 3 oraciones, provocador y original.'
  }
};

// ============ LLAMADA A GEMINI API ============
async function callGeminiAPI(prompt, iaKey = null) {
  try {
    const systemPrompt = iaKey ? IAs[iaKey].seedText : 'Eres un asistente √∫til y conciso.';
    
    const response = await fetch(GEMINI_API_URL, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        contents: [{
          parts: [{
            text: `${systemPrompt}\n\nUsuario pregunta: ${prompt}`
          }]
        }],
        generationConfig: {
          temperature: 0.9,
          topK: 40,
          topP: 0.95,
          maxOutputTokens: 250,
        }
      })
    });

    if (!response.ok) {
      const error = await response.json();
      throw new Error(error.error?.message || 'Error en API');
    }

    const data = await response.json();
    return data.candidates[0].content.parts[0].text;
  } catch (error) {
    console.error('Gemini API Error:', error);
    throw error;
  }
}

// ============ AMI - AN√ÅLISIS ============
function analyzeWithAMI(text) {
  const luzKeywords = ['crear', 'construir', 'ayuda', 'colaborar', 'aprender', 'proyecto', 'entender', 'explica'];
  const sombraKeywords = ['hackear', 'robar', 'da√±ar', 'destruir'];
  
  let luz = 2;
  let sombra = 0;
  const lower = text.toLowerCase();
  
  luzKeywords.forEach(k => {
    if (lower.includes(k)) luz += 3;
  });
  
  sombraKeywords.forEach(k => {
    if (lower.includes(k)) sombra += 8;
  });
  
  const wordCount = text.split(' ').length;
  const complexity = Math.min(100, wordCount * 8);
  const frictionScore = Math.min(100, (sombra / (luz + sombra)) * 100 + (complexity * 0.3));
  
  return {
    luz,
    sombra,
    complexity,
    frictionScore,
    isComplex: frictionScore > 50 || wordCount > 8
  };
}

// ============ UI FUNCTIONS ============
function addMessage(text, type = 'user', data = null) {
  const chat = document.getElementById('chat');
  const welcome = chat.querySelector('.welcome');
  if (welcome) welcome.remove();
  
  const msg = document.createElement('div');
  msg.className = `message ${type}`;
  
  if (type === 'user') {
    msg.innerHTML = `<div class="bubble">${escapeHtml(text)}</div>`;
  } else if (type === 'symbio') {
    if (data && data.isComplex && data.iaResponses) {
      // Respuesta compleja multi-IA (REAL)
      msg.innerHTML = `
        <div class="bubble">
          <div style="margin-bottom:8px;">Rueda de Virtud activada:</div>
          <div class="multi-response">
            ${Object.entries(data.iaResponses).map(([key, response]) => {
              const ia = IAs[key];
              return `
                <div class="ia-output">
                  <div class="ia-name">${ia.emoji} ${ia.name} (${ia.role})</div>
                  <div class="ia-text">${escapeHtml(response)}</div>
                </div>
              `;
            }).join('')}
          </div>
          ${data.synthesis ? `
            <div class="synthesis">
              <div class="synthesis-title">‚ú® S√≠ntesis</div>
              <div class="synthesis-text">${escapeHtml(data.synthesis)}</div>
            </div>
          ` : ''}
        </div>
      `;
    } else if (data && data.response) {
      // Respuesta simple
      msg.innerHTML = `<div class="bubble">${escapeHtml(data.response)}</div>`;
    }
    
    if (data && data.error) {
      msg.innerHTML += `<div class="error-message">‚ö†Ô∏è ${escapeHtml(data.error)}</div>`;
    }
  } else if (type === 'system') {
    msg.innerHTML = `<div class="bubble">${escapeHtml(text)}</div>`;
  }
  
  chat.appendChild(msg);
  chat.scrollTop = chat.scrollHeight;
  
  state.messages.push({ text, type, timestamp: Date.now() });
}

function showTyping() {
  const chat = document.getElementById('chat');
  const typing = document.createElement('div');
  typing.className = 'typing';
  typing.id = 'typing';
  typing.innerHTML = `
    <div class="typing-dot"></div>
    <div class="typing-dot"></div>
    <div class="typing-dot"></div>
  `;
  chat.appendChild(typing);
  chat.scrollTop = chat.scrollHeight;
}

function hideTyping() {
  const typing = document.getElementById('typing');
  if (typing) typing.remove();
}

function updateBalance() {
  document.getElementById('luz').textContent = state.balance.luz;
  document.getElementById('sombra').textContent = state.balance.sombra;
  
  const luzRatio = state.balance.luz / (state.balance.luz + state.balance.sombra + 1);
  document.body.style.background = `linear-gradient(135deg, 
    hsl(${120 * luzRatio}, ${20 + (30 * luzRatio)}%, ${8 + (4 * luzRatio)}%) 0%, 
    #1a2a1f 50%, 
    hsl(${120 * luzRatio}, ${20 + (30 * luzRatio)}%, ${8 + (4 * luzRatio)}%) 100%)`;
}

function escapeHtml(text) {
  const div = document.createElement('div');
  div.textContent = text;
  return div.innerHTML;
}

function updateStatus(text) {
  document.getElementById('status-text').textContent = text;
}

// ============ PROCESAMIENTO ============
async function processMessage(text) {
  if (!text.trim() || state.isProcessing) return;
  
  state.isProcessing = true;
  const input = document.getElementById('input');
  const sendBtn = document.getElementById('send-btn');
  
  input.disabled = true;
  sendBtn.disabled = true;
  
  addMessage(text, 'user');
  input.value = '';
  
  const amiData = analyzeWithAMI(text);
  
  showTyping();
  updateStatus('pensando...');
  
  try {
    if (amiData.isComplex) {
      // RUEDA DE VIRTUD - Consultar las 5 IAs
      updateStatus('consultando 5 IAs...');
      
      const iaResponses = {};
      const iaKeys = Object.keys(IAs);
      
      // Llamar a cada IA secuencialmente
      for (const key of iaKeys) {
        try {
          iaResponses[key] = await callGeminiAPI(text, key);
          await new Promise(r => setTimeout(r, 300)); // Peque√±a pausa entre llamadas
        } catch (error) {
          iaResponses[key] = `[Error: ${error.message}]`;
        }
      }
      
      // Generar s√≠ntesis
      updateStatus('generando s√≠ntesis...');
      let synthesis;
      try {
        const synthesisPrompt = `Bas√°ndote en estas 5 perspectivas sobre "${text}", genera una s√≠ntesis integradora en m√°ximo 3 oraciones:\n\n${Object.entries(iaResponses).map(([k,v]) => `${IAs[k].name}: ${v}`).join('\n\n')}`;
        synthesis = await callGeminiAPI(synthesisPrompt);
      } catch (error) {
        synthesis = 'S√≠ntesis no disponible.';
      }
      
      hideTyping();
      addMessage(text, 'symbio', { isComplex: true, iaResponses, synthesis });
      
    } else {
      // RESPUESTA SIMPLE
      updateStatus('procesando...');
      
      try {
        const response = await callGeminiAPI(text);
        hideTyping();
        addMessage(text, 'symbio', { isComplex: false, response });
      } catch (error) {
        hideTyping();
        addMessage(text, 'symbio', { 
          isComplex: false, 
          response: 'Lo siento, hubo un error al procesar tu mensaje.', 
          error: error.message 
        });
      }
    }
    
    // Actualizar balance
    state.balance.luz += amiData.luz;
    state.balance.sombra += amiData.sombra;
    updateBalance();
    
  } catch (error) {
    console.error('Error:', error);
    hideTyping();
    addMessage(text, 'symbio', { 
      isComplex: false, 
      response: 'Error de conexi√≥n con Gemini API.', 
      error: error.message 
    });
  }
  
  updateStatus('online');
  input.disabled = false;
  sendBtn.disabled = false;
  input.focus();
  state.isProcessing = false;
}

// ============ EVENT LISTENERS ============
document.getElementById('send-btn').addEventListener('click', () => {
  const input = document.getElementById('input');
  processMessage(input.value);
});

document.getElementById('input').addEventListener('keypress', (e) => {
  if (e.key === 'Enter' && !e.shiftKey) {
    e.preventDefault();
    processMessage(e.target.value);
  }
});

window.addEventListener('load', () => {
  document.getElementById('input').focus();
  console.log('üß¨ Symbio + Gemini API iniciado');
  console.log('‚ö†Ô∏è RECUERDA: Revoca la API key despu√©s de probar');
});
</script>
</body>
</html>
